;; -*- coding:utf-8; mode:lisp -*-

(ql:quickload :clgplot)

(in-package :clrf)

;;; sine curve  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defparameter *target*
  (make-array
   '(100 1)
   :element-type 'double-float
   :initial-contents
   '((-0.4839570442454027d0) (-0.7051928982774817d0) (-0.814405928405025d0)
     (0.8633964827462906d0) (0.4357850110535056d0) (-0.29648223419038855d0)
     (-0.5588721929370821d0) (-0.9271211392664264d0) (-0.18527970196582802d0)
     (0.50320964094301d0) (-0.6496198796646036d0) (0.7725633509768315d0)
     (0.740826191703634d0) (0.9326998677698541d0) (0.2464151612906771d0)
     (-0.8537261233207359d0) (-1.235296240303455d0) (-0.4747683460329356d0)
     (0.7963168252263836d0) (0.6847488104917829d0) (0.42326351525976036d0)
     (-0.6670068731929588d0) (1.4643924548276543d0) (-0.3654767834070489d0)
     (0.5192493968066519d0) (-0.4453274951945042d0) (-0.8886094039705982d0)
     (0.3311695830283411d0) (1.1668582307225202d0) (0.04933011670815385d0)
     (0.7415621584070479d0) (-1.156338273471398d0) (-1.1592023653894372d0)
     (0.9596358027394613d0) (-0.6595678728302115d0) (-0.11911877839321436d0)
     (0.9295672155681659d0) (0.7682764439213778d0) (0.3036767117289383d0)
     (-0.6175719668535851d0) (0.13454235566912262d0) (0.3079426939004166d0)
     (1.0017339254175097d0) (-0.5959699009380918d0) (0.5785318913392827d0)
     (0.762491670623352d0) (0.2721740469316668d0) (0.3222083436667229d0)
     (-0.7029990788579277d0) (-0.8257875084927143d0) (-0.6517309099494678d0)
     (-0.4655261461414971d0) (-0.7654859836009205d0) (-0.6861638282751185d0)
     (-0.7701395993628969d0) (0.08742287968347401d0) (-0.5940568678046508d0)
     (-0.44646671018240386d0) (-0.5660045046089877d0) (1.3328276621817265d0)
     (-0.8165685882970996d0) (-0.5187119018178996d0) (1.36023696283064d0)
     (0.28034040168096874d0) (-0.09350927129722841d0) (-0.8812531627504143d0)
     (1.1309965964596005d0) (-1.4068884782284408d0) (1.0083541552861925d0)
     (-0.680189799545737d0) (0.7407203240800974d0) (0.39402645242732487d0)
     (-1.137921935851213d0) (-0.8358226649780318d0) (-0.6859555541340192d0)
     (1.1235197289206675d0) (-0.5640550863143168d0) (-0.1930125329250978d0)
     (0.22813068220371868d0) (-0.8521049928109548d0) (0.2332476369434357d0)
     (1.0313872553707548d0) (0.19962389241094927d0) (-0.2604223457449826d0)
     (0.8091430242484433d0) (-1.0757348126535824d0) (-1.1420284767439d0)
     (0.3523161554323604d0) (0.8538190179455374d0) (0.89832199296351d0)
     (0.5128765495366762d0) (-0.7146800656223395d0) (-0.4009473446625842d0)
     (0.9355772711693087d0) (0.6296403520058416d0) (-0.5900727024485131d0)
     (-0.5612413368121464d0) (0.361535128713055d0) (-0.9144332513780775d0)
     (-0.9964173846555815d0))))

(defparameter *datamatrix*
  (make-array
   '(100 1) 
   :element-type 'double-float
   :initial-contents
   '((-2.2437828524483763d0) (-2.869528774478237d0) (-1.9260489619253394d0)
     (0.8563751280293639d0) (0.8488200710992588d0) (-0.34633388486857264d0)
     (-1.2583304617320468d0) (-1.1359342118990639d0) (-2.9079186274379456d0)
     (2.801978548290826d0) (-1.2693113189503873d0) (0.6324703020443319d0)
     (2.5609955277511167d0) (2.291996461365107d0) (0.946421240751846d0)
     (-2.0926799184623706d0) (-1.4681210214978422d0) (-0.9627244615294375d0)
     (1.7710743996620302d0) (1.0226450047500952d0) (0.6705976596762082d0)
     (-2.381689264884236d0) (1.8756322133150558d0) (-2.8038597650817723d0)
     (2.0960626110899137d0) (-1.1704322497831976d0) (-1.5334324195724043d0)
     (0.527586474294429d0) (2.2826973919602302d0) (-2.9469759350867446d0)
     (2.94133202132418d0) (-1.0408948149179196d0) (-1.80684065979263d0)
     (1.5382423502474776d0) (-0.6519606242735208d0) (3.0120024611481053d0)
     (1.124609350003893d0) (2.5337640198801985d0) (2.140456825165016d0)
     (-2.479632326832612d0) (-0.15258215262023d0) (0.24026556450126257d0)
     (2.1719164431637443d0) (-2.5400289147467072d0) (2.42200065544374d0)
     (2.107932683246866d0) (2.9286243147056243d0) (0.6465987310343673d0)
     (-0.6145143775300084d0) (-1.0513177010092982d0) (-2.649914403970309d0)
     (-0.6521226596728882d0) (-1.0489421418982685d0) (-0.903117331047389d0)
     (-1.5329149005836802d0) (3.130037908628365d0) (-0.9912227961928517d0)
     (-2.7319235346589545d0) (-2.3725341925191277d0) (1.6570832851214066d0)
     (-1.0156749951327844d0) (-0.7485379442393008d0) (1.4943527569404536d0)
     (2.648061477936821d0) (2.9108453784392054d0) (-1.1761537885227356d0)
     (1.3260380243862846d0) (-1.322427857534313d0) (1.5867843204310006d0)
     (-0.742371224801865d0) (2.239993809023013d0) (2.9156772963031203d0)
     (-1.6259434924287435d0) (-2.0168118183556576d0) (-0.29923723957003734d0)
     (1.6916693283172544d0) (-2.0987508847953467d0) (0.022696053035617947d0)
     (0.5081915248975424d0) (-1.6701846631618558d0) (0.192029206649186d0)
     (0.9346409045320412d0) (2.9237368185570087d0) (-0.24820065070557007d0)
     (1.1796923679595954d0) (-2.0851418400110244d0) (-1.787325056465863d0)
     (1.9642255359443803d0) (1.629275309839202d0) (0.8515051058182039d0)
     (0.13481449602451967d0) (-1.95587591760451d0) (-2.8586927469610894d0)
     (2.2023755851404925d0) (0.788151489647535d0) (-1.1123129093371547d0)
     (-0.8951531158184882d0) (2.1725446008830662d0) (-1.9574686828801866d0)
     (-1.9035025298919617d0))))

(defparameter *test*
  (make-array
   '(100 1) 
   :element-type 'double-float
   :initial-contents
   '((-3.0787608005180025d0) (-3.0159289474462065d0) (-2.9530970943744106d0)
     (-2.8902652413026146d0) (-2.8274333882308187d0) (-2.7646015351590227d0)
     (-2.701769682087227d0) (-2.638937829015431d0) (-2.576105975943635d0)
     (-2.513274122871839d0) (-2.450442269800043d0) (-2.387610416728247d0)
     (-2.324778563656451d0) (-2.261946710584655d0) (-2.199114857512859d0)
     (-2.1362830044410632d0) (-2.0734511513692673d0) (-2.0106192982974713d0)
     (-1.9477874452256756d0) (-1.8849555921538796d0) (-1.8221237390820837d0)
     (-1.7592918860102877d0) (-1.6964600329384918d0) (-1.6336281798666958d0)
     (-1.5707963267948999d0) (-1.507964473723104d0) (-1.445132620651308d0)
     (-1.382300767579512d0) (-1.319468914507716d0) (-1.2566370614359201d0)
     (-1.1938052083641242d0) (-1.1309733552923282d0) (-1.0681415022205323d0)
     (-1.0053096491487363d0) (-0.9424777960769405d0) (-0.8796459430051446d0)
     (-0.8168140899333488d0) (-0.753982236861553d0) (-0.6911503837897571d0)
     (-0.6283185307179613d0) (-0.5654866776461654d0) (-0.5026548245743696d0)
     (-0.43982297150257377d0) (-0.3769911184307779d0) (-0.3141592653589821d0)
     (-0.25132741228718625d0) (-0.18849555921539038d0) (-0.1256637061435945d0)
     (-0.06283185307179864d0) (-2.7755575615628914d-15) (0.06283185307179309d0)
     (0.12566370614358896d0) (0.18849555921538483d0) (0.2513274122871807d0)
     (0.31415926535897654d0) (0.3769911184307724d0) (0.4398229715025682d0)
     (0.5026548245743641d0) (0.5654866776461599d0) (0.6283185307179557d0)
     (0.6911503837897516d0) (0.7539822368615474d0) (0.8168140899333433d0)
     (0.8796459430051391d0) (0.9424777960769349d0) (1.0053096491487308d0)
     (1.0681415022205267d0) (1.1309733552923227d0) (1.1938052083641186d0)
     (1.2566370614359146d0) (1.3194689145077105d0) (1.3823007675795065d0)
     (1.4451326206513024d0) (1.5079644737230984d0) (1.5707963267948943d0)
     (1.6336281798666903d0) (1.6964600329384862d0) (1.7592918860102822d0)
     (1.8221237390820781d0) (1.884955592153874d0) (1.94778744522567d0)
     (2.010619298297466d0) (2.073451151369262d0) (2.136283004441058d0)
     (2.199114857512854d0) (2.26194671058465d0) (2.3247785636564458d0)
     (2.3876104167282417d0) (2.4504422698000377d0) (2.5132741228718336d0)
     (2.5761059759436296d0) (2.6389378290154255d0) (2.7017696820872215d0)
     (2.7646015351590174d0) (2.8274333882308134d0) (2.8902652413026093d0)
     (2.9530970943744053d0) (3.015928947446201d0) (3.078760800517997d0)
     (3.141592653589793d0))))

(defparameter *test-target*
  (make-array
   '(100 1) 
   :element-type 'double-float
   :initial-contents
   '((-0.06279051952930827d0) (-0.12533323356429926d0) (-0.18738131458571977d0)
     (-0.24868988716485008d0) (-0.3090169943749429d0) (-0.3681245526846736d0)
     (-0.4257792915650685d0) (-0.4817536741017113d0) (-0.5358267949789929d0)
     (-0.5877852522924696d0) (-0.6374239897486864d0) (-0.6845471059286856d0)
     (-0.7289686274214088d0) (-0.7705132427757867d0) (-0.8090169943749451d0)
     (-0.8443279255020131d0) (-0.8763066800438618d0) (-0.904827052466018d0)
     (-0.92977648588825d0) (-0.9510565162951524d0) (-0.9685831611286302d0)
     (-0.982287250728688d0) (-0.9921147013144774d0) (-0.9980267284282713d0)
     (-1.0d0) (-0.9980267284282718d0) (-0.9921147013144782d0)
     (-0.9822872507286893d0) (-0.9685831611286319d0) (-0.9510565162951544d0)
     (-0.9297764858882525d0) (-0.9048270524660207d0) (-0.8763066800438648d0)
     (-0.8443279255020164d0) (-0.8090169943749489d0) (-0.7705132427757908d0)
     (-0.7289686274214133d0) (-0.6845471059286906d0) (-0.6374239897486917d0)
     (-0.5877852522924752d0) (-0.5358267949789989d0) (-0.48175367410171765d0)
     (-0.4257792915650751d0) (-0.36812455268468053d0) (-0.30901699437495006d0)
     (-0.2486898871648575d0) (-0.18738131458572738d0) (-0.125333233564307d0)
     (-0.06279051952931615d0) (-2.7755575615628914d-15) (0.06279051952931061d0)
     (0.1253332335643015d0) (0.1873813145857219d0) (0.2486898871648521d0)
     (0.3090169943749448d0) (0.36812455268467537d0) (0.4257792915650701d0)
     (0.48175367410171277d0) (0.5358267949789942d0) (0.5877852522924708d0)
     (0.6374239897486874d0) (0.6845471059286865d0) (0.7289686274214094d0)
     (0.7705132427757874d0) (0.8090169943749457d0) (0.8443279255020134d0)
     (0.8763066800438621d0) (0.9048270524660182d0) (0.9297764858882503d0)
     (0.9510565162951528d0) (0.9685831611286305d0) (0.9822872507286882d0)
     (0.9921147013144775d0) (0.9980267284282714d0) (1.0d0) (0.9980267284282717d0)
     (0.9921147013144781d0) (0.982287250728689d0) (0.9685831611286316d0)
     (0.9510565162951542d0) (0.929776485888252d0) (0.9048270524660202d0)
     (0.8763066800438644d0) (0.8443279255020159d0) (0.8090169943749482d0)
     (0.77051324277579d0) (0.7289686274214123d0) (0.6845471059286895d0)
     (0.6374239897486905d0) (0.5877852522924739d0) (0.5358267949789973d0)
     (0.481753674101716d0) (0.4257792915650733d0) (0.36812455268467853d0)
     (0.30901699437494795d0) (0.24868988716485524d0) (0.18738131458572502d0)
     (0.12533323356430454d0) (0.06279051952931358d0) (1.2246467991473532d-16))))

(defparameter x-lst
  '(-2.2437828524483763d0 -2.869528774478237d0 -1.9260489619253394d0
    0.8563751280293639d0 0.8488200710992588d0 -0.34633388486857264d0
    -1.2583304617320468d0 -1.1359342118990639d0 -2.9079186274379456d0
    2.801978548290826d0 -1.2693113189503873d0 0.6324703020443319d0
    2.5609955277511167d0 2.291996461365107d0 0.946421240751846d0
    -2.0926799184623706d0 -1.4681210214978422d0 -0.9627244615294375d0
    1.7710743996620302d0 1.0226450047500952d0 0.6705976596762082d0
    -2.381689264884236d0 1.8756322133150558d0 -2.8038597650817723d0
    2.0960626110899137d0 -1.1704322497831976d0 -1.5334324195724043d0
    0.527586474294429d0 2.2826973919602302d0 -2.9469759350867446d0
    2.94133202132418d0 -1.0408948149179196d0 -1.80684065979263d0
    1.5382423502474776d0 -0.6519606242735208d0 3.0120024611481053d0
    1.124609350003893d0 2.5337640198801985d0 2.140456825165016d0
    -2.479632326832612d0 -0.15258215262023d0 0.24026556450126257d0
    2.1719164431637443d0 -2.5400289147467072d0 2.42200065544374d0
    2.107932683246866d0 2.9286243147056243d0 0.6465987310343673d0
    -0.6145143775300084d0 -1.0513177010092982d0 -2.649914403970309d0
    -0.6521226596728882d0 -1.0489421418982685d0 -0.903117331047389d0
    -1.5329149005836802d0 3.130037908628365d0 -0.9912227961928517d0
    -2.7319235346589545d0 -2.3725341925191277d0 1.6570832851214066d0
    -1.0156749951327844d0 -0.7485379442393008d0 1.4943527569404536d0
    2.648061477936821d0 2.9108453784392054d0 -1.1761537885227356d0
    1.3260380243862846d0 -1.322427857534313d0 1.5867843204310006d0
    -0.742371224801865d0 2.239993809023013d0 2.9156772963031203d0
    -1.6259434924287435d0 -2.0168118183556576d0 -0.29923723957003734d0
    1.6916693283172544d0 -2.0987508847953467d0 0.022696053035617947d0
    0.5081915248975424d0 -1.6701846631618558d0 0.192029206649186d0
    0.9346409045320412d0 2.9237368185570087d0 -0.24820065070557007d0
    1.1796923679595954d0 -2.0851418400110244d0 -1.787325056465863d0
    1.9642255359443803d0 1.629275309839202d0 0.8515051058182039d0
    0.13481449602451967d0 -1.95587591760451d0 -2.8586927469610894d0
    2.2023755851404925d0 0.788151489647535d0 -1.1123129093371547d0
    -0.8951531158184882d0 2.1725446008830662d0 -1.9574686828801866d0
    -1.9035025298919617d0))

(defparameter y-lst
  '(-0.4839570442454027d0 -0.7051928982774817d0 -0.814405928405025d0
    0.8633964827462906d0 0.4357850110535056d0 -0.29648223419038855d0
    -0.5588721929370821d0 -0.9271211392664264d0 -0.18527970196582802d0
    0.50320964094301d0 -0.6496198796646036d0 0.7725633509768315d0
    0.740826191703634d0 0.9326998677698541d0 0.2464151612906771d0
    -0.8537261233207359d0 -1.235296240303455d0 -0.4747683460329356d0
    0.7963168252263836d0 0.6847488104917829d0 0.42326351525976036d0
    -0.6670068731929588d0 1.4643924548276543d0 -0.3654767834070489d0
    0.5192493968066519d0 -0.4453274951945042d0 -0.8886094039705982d0
    0.3311695830283411d0 1.1668582307225202d0 0.04933011670815385d0
    0.7415621584070479d0 -1.156338273471398d0 -1.1592023653894372d0
    0.9596358027394613d0 -0.6595678728302115d0 -0.11911877839321436d0
    0.9295672155681659d0 0.7682764439213778d0 0.3036767117289383d0
    -0.6175719668535851d0 0.13454235566912262d0 0.3079426939004166d0
    1.0017339254175097d0 -0.5959699009380918d0 0.5785318913392827d0
    0.762491670623352d0 0.2721740469316668d0 0.3222083436667229d0
    -0.7029990788579277d0 -0.8257875084927143d0 -0.6517309099494678d0
    -0.4655261461414971d0 -0.7654859836009205d0 -0.6861638282751185d0
    -0.7701395993628969d0 0.08742287968347401d0 -0.5940568678046508d0
    -0.44646671018240386d0 -0.5660045046089877d0 1.3328276621817265d0
    -0.8165685882970996d0 -0.5187119018178996d0 1.36023696283064d0
    0.28034040168096874d0 -0.09350927129722841d0 -0.8812531627504143d0
    1.1309965964596005d0 -1.4068884782284408d0 1.0083541552861925d0
    -0.680189799545737d0 0.7407203240800974d0 0.39402645242732487d0
    -1.137921935851213d0 -0.8358226649780318d0 -0.6859555541340192d0
    1.1235197289206675d0 -0.5640550863143168d0 -0.1930125329250978d0
    0.22813068220371868d0 -0.8521049928109548d0 0.2332476369434357d0
    1.0313872553707548d0 0.19962389241094927d0 -0.2604223457449826d0
    0.8091430242484433d0 -1.0757348126535824d0 -1.1420284767439d0
    0.3523161554323604d0 0.8538190179455374d0 0.89832199296351d0
    0.5128765495366762d0 -0.7146800656223395d0 -0.4009473446625842d0
    0.9355772711693087d0 0.6296403520058416d0 -0.5900727024485131d0
    -0.5612413368121464d0 0.361535128713055d0 -0.9144332513780775d0
    -0.9964173846555815d0))

(defparameter pred-x-lst
  '(-3.0787608005180025d0 -3.0159289474462065d0 -2.9530970943744106d0
    -2.8902652413026146d0 -2.8274333882308187d0 -2.7646015351590227d0
    -2.701769682087227d0 -2.638937829015431d0 -2.576105975943635d0
    -2.513274122871839d0 -2.450442269800043d0 -2.387610416728247d0
    -2.324778563656451d0 -2.261946710584655d0 -2.199114857512859d0
    -2.1362830044410632d0 -2.0734511513692673d0 -2.0106192982974713d0
    -1.9477874452256756d0 -1.8849555921538796d0 -1.8221237390820837d0
    -1.7592918860102877d0 -1.6964600329384918d0 -1.6336281798666958d0
    -1.5707963267948999d0 -1.507964473723104d0 -1.445132620651308d0
    -1.382300767579512d0 -1.319468914507716d0 -1.2566370614359201d0
    -1.1938052083641242d0 -1.1309733552923282d0 -1.0681415022205323d0
    -1.0053096491487363d0 -0.9424777960769405d0 -0.8796459430051446d0
    -0.8168140899333488d0 -0.753982236861553d0 -0.6911503837897571d0
    -0.6283185307179613d0 -0.5654866776461654d0 -0.5026548245743696d0
    -0.43982297150257377d0 -0.3769911184307779d0 -0.3141592653589821d0
    -0.25132741228718625d0 -0.18849555921539038d0 -0.1256637061435945d0
    -0.06283185307179864d0 -2.7755575615628914d-15 0.06283185307179309d0
    0.12566370614358896d0 0.18849555921538483d0 0.2513274122871807d0
    0.31415926535897654d0 0.3769911184307724d0 0.4398229715025682d0
    0.5026548245743641d0 0.5654866776461599d0 0.6283185307179557d0
    0.6911503837897516d0 0.7539822368615474d0 0.8168140899333433d0
    0.8796459430051391d0 0.9424777960769349d0 1.0053096491487308d0
    1.0681415022205267d0 1.1309733552923227d0 1.1938052083641186d0
    1.2566370614359146d0 1.3194689145077105d0 1.3823007675795065d0
    1.4451326206513024d0 1.5079644737230984d0 1.5707963267948943d0
    1.6336281798666903d0 1.6964600329384862d0 1.7592918860102822d0
    1.8221237390820781d0 1.884955592153874d0 1.94778744522567d0
    2.010619298297466d0 2.073451151369262d0 2.136283004441058d0
    2.199114857512854d0 2.26194671058465d0 2.3247785636564458d0
    2.3876104167282417d0 2.4504422698000377d0 2.5132741228718336d0
    2.5761059759436296d0 2.6389378290154255d0 2.7017696820872215d0
    2.7646015351590174d0 2.8274333882308134d0 2.8902652413026093d0
    2.9530970943744053d0 3.015928947446201d0 3.078760800517997d0
    3.141592653589793d0))

(defparameter pred-y-lst
  '(-0.06797479262883709d0 -0.06797479262883709d0 -0.06797479262883709d0
    -0.06797479262883709d0 -0.4795209341323797d0 -0.4795209341323797d0
    -0.4795209341323797d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.8396750034324487d0 -0.8396750034324487d0
    -0.8396750034324487d0 -0.6912458842141245d0 -0.6912458842141245d0
    -0.6912458842141245d0 -0.6912458842141245d0 -0.6912458842141245d0
    -0.6912458842141245d0 -0.6912458842141245d0 -0.6912458842141245d0
    -0.6912458842141245d0 -0.6912458842141245d0 -0.6912458842141245d0
    -0.6912458842141245d0 -0.4912188941622039d0 -0.4912188941622039d0
    -0.2604223457449826d0 0.13454235566912262d0 0.13454235566912262d0
    0.13454235566912262d0 -0.1930125329250978d0 -0.1930125329250978d0
    0.5128765495366762d0 0.2705951654219262d0 0.2705951654219262d0
    0.2705951654219262d0 0.2796501326160299d0 0.2796501326160299d0
    0.2796501326160299d0 0.2796501326160299d0 0.7725633509768315d0
    0.42326351525976036d0 0.7253783673043301d0 0.7253783673043301d0
    0.7253783673043301d0 0.7253783673043301d0 0.7253783673043301d0
    0.7253783673043301d0 0.7253783673043301d0 0.7253783673043301d0
    0.7253783673043301d0 1.1144554673797626d0 1.1144554673797626d0
    1.1144554673797626d0 1.1144554673797626d0 1.1144554673797626d0
    1.1144554673797626d0 1.1144554673797626d0 1.1144554673797626d0
    1.1144554673797626d0 1.1144554673797626d0 0.4844334836478257d0
    0.4844334836478257d0 0.4844334836478257d0 0.4844334836478257d0
    0.8029732527596267d0 0.8029732527596267d0 0.8029732527596267d0
    0.8029732527596267d0 0.8029732527596267d0 0.8029732527596267d0
    0.8029732527596267d0 0.28034040168096874d0 0.28034040168096874d0
    0.50320964094301d0 0.50320964094301d0 0.19307878011817814d0
    0.7415621584070479d0 -0.11911877839321436d0 -0.11911877839321436d0
    0.08742287968347401d0))

(defparameter pred-forest-y-lst
  '(-0.13865457358136246d0 -0.13865457358136246d0 -0.13865457358136246d0
    -0.34284135138726984d0 -0.46182415963576384d0 -0.4327119437552419d0
    -0.45439700480611134d0 -0.5973937950955296d0 -0.5973937950955296d0
    -0.6256403794002479d0 -0.6256403794002479d0 -0.620380501875349d0
    -0.6210074149141478d0 -0.6179475965195831d0 -0.6382049180346695d0
    -0.7271550543549076d0 -0.9172253402489267d0 -0.8697702275645749d0
    -0.8464510426853465d0 -1.028594995012981d0 -1.105055931666687d0
    -1.054424789137323d0 -0.9819917176450466d0 -1.015852848720671d0
    -0.9459884678381322d0 -1.1067846676651336d0 -1.1706796912044513d0
    -1.1706796912044513d0 -1.0555484733942495d0 -0.6137074237691754d0
    -0.6767249831475315d0 -0.7478229426392751d0 -0.8629267696895793d0
    -0.7317649155207164d0 -0.5863573429212259d0 -0.5933224150966078d0
    -0.5963189763005753d0 -0.5944827058346642d0 -0.5665274421968359d0
    -0.5990184451632876d0 -0.5500464088165875d0 -0.5123358835721264d0
    -0.4833388768675607d0 -0.4138159556506604d0 -0.35084470112316485d0
    -0.2814546935224054d0 -0.12946683248148075d0 0.016134185281362904d0
    -0.009880322296070668d0 -0.009880322296070668d0 0.11715191100063056d0
    0.273949989652411d0 0.2731720592243855d0 0.24631535715604969d0
    0.24159094026890732d0 0.2870435998442338d0 0.32620075906607215d0
    0.32620075906607215d0 0.3994930463122578d0 0.5086446920588805d0
    0.5063163653103036d0 0.6687098361667542d0 0.6687098361667542d0
    0.7021515807134262d0 0.7861220747922155d0 0.7917258207141861d0
    0.8314507796097825d0 0.9212475266398947d0 0.9390024870918291d0
    1.0441806379843115d0 1.1212758684181519d0 1.1769161462041917d0
    1.1769161462041917d0 1.141119374742995d0 1.0293780682871614d0
    0.9991567142242381d0 1.1204145374239773d0 0.8647962252236076d0
    0.9778161088446327d0 0.9676223048457944d0 0.6102428171797509d0
    0.519069631226124d0 0.5130077680742001d0 0.5509436028735746d0
    0.8440799241989158d0 0.8831557270249594d0 0.9054397283372827d0
    0.7534801872479043d0 0.731396005082767d0 0.7269054621422919d0
    0.609012107770039d0 0.4514405081955447d0 0.3609002370087483d0
    0.3609002370087483d0 0.35076300020461987d0 0.16662225879267073d0
    0.3011816692351711d0 0.18712254043869575d0 0.18712254043869575d0
    0.18712254043869575d0))

(clgp:plots (list y-lst pred-y-lst pred-forest-y-lst)
            :x-seqs (list x-lst pred-x-lst pred-x-lst)
            :style '(points lines lines)
            :title-list '("training" "predict(dtree)" "predict(forest)")
            ;; :output "/home/wiz/tmp/regression-tree.png"
            )
  
;; make decision tree
(defparameter *rtree* (make-rtree *datamatrix* *target* :max-depth 5 :min-region-samples 1 :n-trial 25))

;; test by training data
(test-rtree *rtree* *datamatrix* *target*)
;; test by testing data
(test-rtree *rtree* *test* *test-target*)

(predict-rtree *rtree* *test* 0)

;; display tree information
(traverse #'node-information-gain (dtree-root *rtree*))
(traverse #'node-sample-indices (dtree-root *rtree*))

(do-leaf #'node-sample-indices (dtree-root *rtree*))

;; make random forest
(defparameter *rforest*
  (make-regression-forest *datamatrix* *target* :n-tree 100 :bagging-ratio 0.2 :max-depth 15 :min-region-samples 1  :n-trial 10))

(clgp:plots (list y-lst
                  (loop for i from 0 below 100
                        collect (aref (predict-rtree *rtree* *test* i) 0))
                  (loop for i from 0 below 100
                        collect (aref (predict-regression-forest *rforest* *test* i) 0))
                  (mapcar #'sin pred-x-lst))
            :x-seqs (list x-lst pred-x-lst pred-x-lst pred-x-lst)
            :style '(points lines lines lines)
            :title-list '("training" "predict(dtree)" "predict(forest)" "true")
            :output "/home/wiz/Dropbox/tmp/regression-forest.png"
            :x-range '(-3.3 3.3)
            :y-range '(-1.5 2.0)
            )

;; test random forest
(test-regression-forest *rforest* *datamatrix* *target*)
(test-regression-forest *rforest* *test* *test-target*)
